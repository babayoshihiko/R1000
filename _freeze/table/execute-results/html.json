{
  "hash": "393c630f635b6921f03a66cad2a299b9",
  "result": {
    "markdown": "# 表 {#table}\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n## クロス集計\n\n::: callout-tip\n\n::: {.cell}\n\n:::\n\nTIP 088: クロス集計 `ftable()`\n:::\n\nデータをインポートし、データフレーム `dfInjury` に格納します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\ndfInjury <- read_excel(\"kentei4.xlsx\", sheet = \"p55-raw\")\ndfInjury$Reason <- factor(dfInjury$Reason)\ndfInjury$Gender <- factor(dfInjury$Gender)\n```\n:::\n\n\n次に、Base R にある `ftable()` 関数を使って、クロス集計表を出力してみます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nftable(dfInjury, row.vars = \"Gender\", col.vars = \"Reason\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Reason すり傷 その他 ねんざ 切り傷 発熱 腹痛 頭痛\nGender                                                  \nF                  2      2      2      3    3    2   10\nM                  7      1      1      2    0    3    3\n```\n:::\n:::\n\n\n::: callout-tip\n\n::: {.cell}\n\n:::\n\nTIP 089: クロス集計 **{crosstable}**\n:::\n\nこれは、確認するためには十分ですが、報告書にこのまま記載するわけにはいきません。 そこで、もう少し見た目の良い表を作るために **{crosstable}** というパッケージを追加してみます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(crosstable)\nas_flextable(crosstable(dfInjury, cols = Reason, by = Gender))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-60d1ef18{table-layout:auto;}.cl-60ce43e0{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-60ce43ea{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-60cf9290{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-60cf929a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-60cfa10e{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(0, 0, 0, 1.00);border-top: 1.5pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60cfa10f{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1.5pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60cfa110{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60cfa118{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-60cfa119{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-60d1ef18'><thead><tr style=\"overflow-wrap:break-word;\"><th  rowspan=\"2\"class=\"cl-60cfa10e\"><p class=\"cl-60cf9290\"><span class=\"cl-60ce43e0\">label</span></p></th><th  rowspan=\"2\"class=\"cl-60cfa10e\"><p class=\"cl-60cf9290\"><span class=\"cl-60ce43e0\">variable</span></p></th><th  colspan=\"2\"class=\"cl-60cfa10f\"><p class=\"cl-60cf9290\"><span class=\"cl-60ce43e0\">Gender</span></p></th></tr><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-60cfa110\"><p class=\"cl-60cf9290\"><span class=\"cl-60ce43e0\">F</span></p></th><th class=\"cl-60cfa110\"><p class=\"cl-60cf9290\"><span class=\"cl-60ce43e0\">M</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td  rowspan=\"7\"class=\"cl-60cfa118\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">Reason</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">すり傷</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">2 (22.22%)</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">7 (77.78%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">その他</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">2 (66.67%)</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">1 (33.33%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">ねんざ</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">2 (66.67%)</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">1 (33.33%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">切り傷</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">3 (60.00%)</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">2 (40.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">発熱</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">3 (100.00%)</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">0 (0%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">腹痛</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">2 (40.00%)</span></p></td><td class=\"cl-60cfa119\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">3 (60.00%)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-60cfa118\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">頭痛</span></p></td><td class=\"cl-60cfa118\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">10 (76.92%)</span></p></td><td class=\"cl-60cfa118\"><p class=\"cl-60cf929a\"><span class=\"cl-60ce43ea\">3 (23.08%)</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## 要約\n\n::: callout-tip\n\n::: {.cell}\n\n:::\n\nTIP 090: **{tables}**\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tables)\ntable_options(htmloptions(head=FALSE))\ntoHTML(tabular(dfInjury$Reason ~ dfInjury$Gender))\n```\n\n::: {.cell-output-display}\n```{=html}\n<table class=\"Rtable\">\n <thead>\n <tr class=\"center\">\n  <th>&nbsp;</th>\n  <th colspan=\"2\">dfInjury$Gender</th>\n</tr>\n <tr class=\"center\">\n  <th>dfInjury$Reason</th>\n  <th>F</th>\n  <th>M</th>\n</tr>\n </thead>\n <tbody>\n <tr class=\"center\">\n  <th class=\"left\">すり傷</th>\n  <td> 2</td>\n  <td>7</td>\n</tr>\n <tr class=\"center\">\n  <th class=\"left\">その他</th>\n  <td> 2</td>\n  <td>1</td>\n</tr>\n <tr class=\"center\">\n  <th class=\"left\">ねんざ</th>\n  <td> 2</td>\n  <td>1</td>\n</tr>\n <tr class=\"center\">\n  <th class=\"left\">切り傷</th>\n  <td> 3</td>\n  <td>2</td>\n</tr>\n <tr class=\"center\">\n  <th class=\"left\">発熱</th>\n  <td> 3</td>\n  <td>0</td>\n</tr>\n <tr class=\"center\">\n  <th class=\"left\">腹痛</th>\n  <td> 2</td>\n  <td>3</td>\n</tr>\n <tr class=\"center\">\n  <th class=\"left\">頭痛</th>\n  <td>10</td>\n  <td>3</td>\n</tr>\n </tbody>\n </table>\n\n```\n:::\n:::\n\n\n::: callout-tip\n\n::: {.cell}\n\n:::\n\nTIP 091: **{tableone}**\n:::\n\n医療系の場合、クロス集計表には、質的データにはχ二乗検定、量的データにはt検定（どちらも正規分布を仮定しています）を行い、その p 値を付すことが多い用です。 なお、上記の `crosstable` でも、`test = TRUE` という引数を追加することで検定結果を追加することができます。\n\nそこで、医療系にあったクロス集計表を作成してみます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tableone)\nCreateTableOne(data = dfInjury, strata = \"Gender\", factorVars = \"Reason\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       Stratified by Gender\n                        F             M              p      test\n  n                        24            17                     \n  StudentID (mean (SD)) 23.42 (12.45) 17.59 (10.72)   0.126     \n  Reason (%)                                          0.138     \n     すり傷                 2 ( 8.3)      7 ( 41.2)             \n     その他                 2 ( 8.3)      1 (  5.9)             \n     ねんざ                 2 ( 8.3)      1 (  5.9)             \n     切り傷                 3 (12.5)      2 ( 11.8)             \n     発熱                   3 (12.5)      0 (  0.0)             \n     腹痛                   2 ( 8.3)      3 ( 17.6)             \n     頭痛                  10 (41.7)      3 ( 17.6)             \n  Gender = M (%)            0 ( 0.0)     17 (100.0)  <0.001     \n```\n:::\n:::\n\n\n医療系ということもあり、引数も比較的わかりやすいものになっています。\n\n引数\n\n-   `data`: データフレーム\n-   `strata`: 層別化する列\n-   `factorVars`: データが因子の列。χ二乗検定される。他の列は量的データとみなされ、t検定される。\n\n::: callout-tip\n\n::: {.cell}\n\n:::\n\nTIP 092: クロス集計 **{rpivotTable}**\n:::\n\n\n最後に、インタラクティブに操作することができる **{rpivotTable}** パッケージを紹介します。 これは、HTML の特徴を生かして、ウェブページ上で表示を変えることができるものになります。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rpivotTable)\nrpivotTable(dfInjury, rows=\"Gender\", cols=\"Reason\", width=\"100%\", height=\"400px\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-4e32759f928f60bb9a3a\" style=\"width:100%;height:400px;\" class=\"rpivotTable html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-4e32759f928f60bb9a3a\">{\"x\":{\"data\":{\"StudentID\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41],\"Reason\":[\"すり傷\",\"切り傷\",\"すり傷\",\"頭痛\",\"すり傷\",\"その他\",\"頭痛\",\"腹痛\",\"切り傷\",\"切り傷\",\"腹痛\",\"頭痛\",\"頭痛\",\"すり傷\",\"その他\",\"すり傷\",\"頭痛\",\"頭痛\",\"頭痛\",\"ねんざ\",\"ねんざ\",\"すり傷\",\"腹痛\",\"すり傷\",\"すり傷\",\"発熱\",\"頭痛\",\"ねんざ\",\"その他\",\"すり傷\",\"切り傷\",\"切り傷\",\"腹痛\",\"頭痛\",\"発熱\",\"発熱\",\"腹痛\",\"頭痛\",\"頭痛\",\"頭痛\",\"頭痛\"],\"Gender\":[\"M\",\"M\",\"F\",\"F\",\"M\",\"F\",\"F\",\"M\",\"F\",\"M\",\"M\",\"F\",\"M\",\"F\",\"F\",\"M\",\"F\",\"F\",\"M\",\"F\",\"M\",\"M\",\"M\",\"M\",\"M\",\"F\",\"F\",\"F\",\"M\",\"M\",\"F\",\"F\",\"F\",\"F\",\"F\",\"F\",\"F\",\"F\",\"F\",\"M\",\"F\"]},\"params\":{\"rows\":[\"Gender\"],\"cols\":[\"Reason\"]},\"locale\":\"en\",\"subtotals\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"site_libs/jquery-1.11.2/jquery.min.js\"></script>\n<link href=\"site_libs/jquery-ui-1.11.4/jquery-ui.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/jquery-ui-1.11.4/jquery-ui.min.js\"></script>\n<script src=\"site_libs/jquery-ui-1.11.4/jquery.ui.touch-punch.min.js\"></script>\n<link href=\"site_libs/c3-0.4.11/c3.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/c3-0.4.11/c3.min.js\"></script>\n<script src=\"site_libs/d3-3.5.5/d3.v3.min.js\"></script>\n<link href=\"site_libs/pivottable-2.19.0/pivot.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pivottable-2.19.0/pivot.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/d3_renderers.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/c3_renderers.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.cs.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.da.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.de.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.es.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.fr.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.it.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.nl.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.pl.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.pt.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.ru.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.sq.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.tr.min.js\"></script>\n<script src=\"site_libs/pivottable-2.19.0/pivot.zh.min.js\"></script>\n<link href=\"site_libs/subtotal-1.10.0/subtotal.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/subtotal-1.10.0/subtotal.min.js\"></script>\n<script src=\"site_libs/polyfill-0.1/polyfill.min.js\"></script>\n<link href=\"site_libs/rpivotTable_style-0.1/rpivotTable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/rpivotTable-binding-0.3.0/rpivotTable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}